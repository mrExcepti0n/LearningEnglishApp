@using  LearningEnglishWeb.ViewModels.Training.CollectWord
@using  LearningEnglishWeb.ViewModels.Training.Abstractions
@model TrainingViewModel<CollectWordQuestionViewModel>


@{
    ViewData["Title"] = "Index";
}


<div class="trainingArea cwTrainingArea" data-isreverse="@Model.IsReverse">
    <input id="trainingId" type="hidden" value="@Model.TrainingId" />
    @await Html.PartialAsync("CollectWordTrainingQuestion", @Model.CurrentQuestion)
</div>


@section Scripts{

    <script type="module">
        import { TrainingBase } from "../js/training.js";

        (function () {

            let isReverse = document.querySelector('.trainingArea').dataset['isreverse'] == "True";
            let trainingId = document.querySelector('#trainingId').value;
            let training = new TrainingBase(trainingId, isReverse);

            $(document).on("click", '.optionsArea button.letter', function (evt) {
                this.classList.add('btn-warning');
                this.classList.remove('btn-info');
                document.querySelector(".userAnswerArea").appendChild(this);
                if (allLettersIsCollect()) {
                    training.checkAnswer('@Url.Action("CheckAnswer")', getAnswer());
                }
            });

            $(document).on("click", '.userAnswerArea button.letter', function (evt) {
                this.classList.add('btn-info');
                this.classList.remove('btn-warning');
                document.querySelector(".optionsArea").appendChild(this);
            });

            function getAnswer() {
                let answer = '';
                document.querySelectorAll('.userAnswerArea button.letter').forEach(el => {
                    answer += el.innerText;
                });
                return answer;
            }
            function allLettersIsCollect() {
                return document.querySelector(".optionsArea").children.length === 0;
            }
        })();

    </script>
}
